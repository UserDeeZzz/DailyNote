### 索引

用于提高数据查询和排序的数据结构

### 索引的常见模型

#### 哈希表

把k-v放在数组里，key经过哈希函数的换算成数组指定位置，出现哈希冲突用拉链法，适用于等值查询和范围查询，二分法可以进行搜索，但是插入效率低，因此只适用于静态存储索引，保存不再改变的历史数据

![](https://static001.geekbang.org/resource/image/0c/57/0c62b601afda86fe5d0fe57346ace957.png)

#### 二叉搜索树

左子树<父节点<右子树，中序遍历得出排序结果

树层数多，导致需要读磁盘的次数多

![](https://static001.geekbang.org/resource/image/04/68/04fb9d24065635a6a637c25ba9ddde68.png)

#### N叉树

数据页大小`16K`，以`InnoDB`的一个整数字段索引为例，每个数据页存1000个节点。这棵树高是4的时候，就可以存1000的3次方个值，这已经10亿了。考虑到树根的数据块总是在内存中的，一个10亿行的表上一个整数字段的索引，查找一个值最多只需要访问3次磁盘。其实，树的第二层也有很大概率在内存中，那么访问磁盘的平均次数就更少了。

#### `InnoDB` 的索引模型

在`InnoDB`中，表都是根据主键顺序以索引的形式存放的，这种存储方式的表称为索引组织表，`InnoDB`使用了B+树索引模型，所以数据都是存储在B+树中的叶节点。

![](https://static001.geekbang.org/resource/image/dc/8d/dcda101051f28502bd5c4402b292e38d.png)

#####  聚簇索引

主键索引也被称为聚簇索引

##### 普通索引

非主键索引也被称为普通索引

##### 回表

在一个普通索引树上搜索完需要再次在id索引树搜索取数据

##### 自增主键

显然，主键长度越小，普通索引的叶子节点就越小，普通索引占用的空间也就越小

插入过程中按自增主键插入，避免插入数据页分裂，删除数据页合并

##### 页分裂 页合并

不按id升序插入会导致b+树增加节点时m阶b树的定义，节点分裂，删除节点时小于m/2，节点合并，不会删除空节点，会给空节点加标记逻辑删除，等待新插入节点复用，因此空间利用率低

